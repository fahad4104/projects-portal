generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  RISK
  COMPLETED
}

enum Role {
  OWNER        // المالك
  CONTRACTOR   // المقاول
  CONSULTANT   // الاستشاري
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  DONE
}

model Project {
  id              String         @id @default(cuid())
  code            String         @unique   // مثل P-001
  name            String
  ownerName       String
  contractorName  String
  consultantName  String?
  status          ProjectStatus  @default(IN_PROGRESS)

  tasks           Task[]
  drawings        Drawing[]      // ✅ علاقة المخططات

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

model Task {
  id             String      @id @default(cuid())
  project        Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId      String

  title          String
  status         TaskStatus  @default(PENDING)

  ownerRole      Role        // اللي صنع المهمة
  targetRole     Role        // الموجهة له المهمة
  visibleToRoles String      // نخزنها كنص "OWNER,CONTRACTOR" مثلاً

  createdAt      DateTime    @default(now())
  completedAt    DateTime?
}

model Drawing {
  id         String   @id @default(cuid())
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId  String

  boxName    String        // اسم المربع (قابل للتعديل)
  fileName   String?       // اسم الملف الأصلي
  filePath   String?       // مسار الملف داخل public/uploads
  uploadedBy String?       // من رفع الملف (حالياً: الدور)
  uploadedAt DateTime?     // وقت الرفع
  isArchived Boolean  @default(false) // لو true يظهر في الأرشيف
}
